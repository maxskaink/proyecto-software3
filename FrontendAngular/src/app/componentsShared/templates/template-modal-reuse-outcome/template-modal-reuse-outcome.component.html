<div class="modal-container">
  <!-- Header fijo con botón de cierre y select -->
  <div class="fixed-header">
    <div class="modal-header align-items-center">
      <h2 class="fw-bold title modal-title">Reutilizar Resultado de Aprendizaje</h2>
      <button
        mat-icon-button
        class="close-button"
        aria-label="Cerrar diálogo"
        (click)="dialogRef.close()"
      >
        <span class="close-x">×</span>
      </button>
    </div>
  
    <div class="dropdown-wrapper">
      <select
        class="form-select custom-select-style clickable-select"
        [(ngModel)]="selectedOption"
        (change)="onOptionChange()"
      >
        <option value="" disabled>
          {{ data.selectPlaceholder || "Selecciona una opción" }}
        </option>
        <option *ngFor="let opt of data.options" [value]="opt">
          {{ opt }}
        </option>
      </select>
    </div>
  </div>

  <!-- Contenido scrolleable -->
  <div class="scrollable-content">
    <section class="ra-content">
      <ng-container *ngIf="outcomes$ | async as outcomes; else loadingOutcomes">
        <!-- Remove any spacing between RA rows -->
        <div
          *ngFor="let outcome of outcomes; let i = index"
          class="ra-row"
          [class.selected]="outcome.selected"
          (click)="
            !(!outcome.selected && selectedCount >= (data.maxOutcomes || 3)) &&
              toggleOutcomeSelection(outcome)
          "
          [class.disabled-row]="
            !outcome.selected && selectedCount >= (data.maxOutcomes || 3)
          "
        >
          <!-- Contenido existente -->
          <div class="outcome-cell">
            <app-molecule-out-come
              [outcomeNumber]="i + 1"
              [outcome]="outcome.description"
            >
            </app-molecule-out-come>
          </div>

          <div class="action-cell">
            <button
              class="ra-action-icon"
              [class.disabled]="
                !outcome.selected && selectedCount >= (data.maxOutcomes || 3)
              "
              [disabled]="
                !outcome.selected && selectedCount >= (data.maxOutcomes || 3)
              "
            >
              {{ outcome.selected ? "✓" : "−" }}
            </button>
          </div>
        </div>
      </ng-container>
      <ng-template #loadingOutcomes>
        <p *ngIf="loading.outcomes">Cargando resultados de aprendizaje...</p>
        <p *ngIf="error.outcomes">
          Error al cargar los resultados de aprendizaje
        </p>
      </ng-template>
    </section>
  </div>
</div>

<div mat-dialog-actions>
  <button
    mat-raised-button
    class="button_save"
    (click)="saveSelectedOutcomes()"
  >
    Guardar
  </button>
</div>
